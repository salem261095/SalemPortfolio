---
import testimonialsData from "@/data/testimonials.json";
import { ArrowLeft, ArrowRight } from "@lucide/astro";
import H2 from "./H2.astro";
---

<style>
  .testimonial-slide {
    position: absolute;
    inset: 0;
    opacity: 0;
    transition: opacity 0.6s ease-in-out;
    pointer-events: none;
  }
  .testimonial-slide.active {
    opacity: 1;
    pointer-events: auto;
    position: relative;
  }
</style>

<section
  class="relative w-full max-w-xl mx-auto py-6 text-center"
  aria-label="شهادات العملاء"
>
  <H2 text="اراء العملاء" />

  <div
    class="overflow-hidden border rounded-lg p-6 bg-white dark:bg-zinc-900 dark:border-zinc-950 relative"
  >
    <div id="testimonial-carousel" class="relative">
      {
        testimonialsData.map((testi, idx) => (
          <div
            class={`testimonial-slide ${idx === 0 ? "active" : ""}`}
            data-index={idx}
          >
            <p set:html={testi.content} />
            <div class="mt-6">
              <a href={testi.url} class="font-bold">
                {testi.Title}
              </a>
              <p class="text-sm mt-2 text-gray-500 dark:text-white">
                {testi.testimonialPosition}
              </p>
            </div>
          </div>
        ))
      }
    </div>
  </div>

  <div class="flex justify-center gap-4 mt-4">
    <button
      id="prev"
      class="bg-black text-white dark:text-black dark:bg-white p-1 md:p-2 rounded"
    >
      <ArrowRight />
    </button>
    <button
      id="next"
      class="bg-black text-white dark:text-black dark:bg-white p-1 md:p-2 rounded"
    >
      <ArrowLeft />
    </button>
  </div>

  <script is:inline>
    const slides = document.querySelectorAll(".testimonial-slide");
    let current = 0;

    const updateSlides = () => {
      slides.forEach((slide, i) => {
        slide.classList.toggle("active", i === current);
      });
    };

    document.getElementById("prev").addEventListener("click", () => {
      current = (current - 1 + slides.length) % slides.length;
      updateSlides();
    });

    document.getElementById("next").addEventListener("click", () => {
      current = (current + 1) % slides.length;
      updateSlides();
    });

    setInterval(() => {
      current = (current + 1) % slides.length;
      updateSlides();
    }, 5000);

    updateSlides();
  </script>
</section>
